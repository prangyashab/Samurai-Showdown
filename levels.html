<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Samurai Showdown - Levels</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Press Start 2P', cursive;
        }

        body {
            background-color: #2c2c2c;
            background-image: url('./img/homepage.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            text-shadow: 4px 4px 0px #000;
            overflow: hidden;
            position: relative;
        }

        /* Dark overlay */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1;
            pointer-events: none;
        }

        /* Top Navigation */
        .top-nav {
            position: absolute;
            top: 20px;
            width: 100%;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            z-index: 2;
        }

        .icon-btn {
            width: 70px;
            height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-decoration: none;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
            background: transparent;
        }

        .icon-btn:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }

        /* Generic Button Style (for Modal) */
        .btn {
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
            box-shadow: 6px 6px 0px #000;
            display: inline-block;
            text-align: center;
            color: white;
            border: 4px solid white;
            text-shadow: 2px 2px 0px #000;
        }

        .btn:hover {
            transform: scale(1.05);
            filter: brightness(1.2);
            /* Brightens any color button */
        }

        .btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px #000;
        }

        /* Main Content */
        .container {
            position: relative;
            z-index: 2;
            width: 90%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        h1 {
            font-size: 48px;
            margin-bottom: 10px;
            text-transform: uppercase;
            text-align: center;
        }

        .level-banner {
            background-color: #fca5a5;
            /* Light red/orange base */
            background: linear-gradient(to bottom, #fbbf24, #f59e0b);
            /* Gold gradient */
            padding: 10px 40px;
            border: 4px solid white;
            color: white;
            font-size: 24px;
            margin-bottom: 30px;
            position: relative;
            display: inline-block;
            box-shadow: 0 4px 0 #000;
        }

        .level-banner::before {
            content: 'â€º';
            position: absolute;
            left: 10px;
        }

        .level-banner::after {
            content: 'â€¹';
            position: absolute;
            right: 10px;
        }

        /* Grid */
        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 15px;
            width: 95%;
            max-width: 1400px;
            /* Allow wide layout */
            justify-content: center;
            padding-top: 35px;
            /* Increased space for popping stars to avoid cut-off */
            padding-bottom: 50px;
            overflow-y: auto;
            max-height: calc(100vh - 180px);

            /* Hide scrollbar */
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        .level-grid::-webkit-scrollbar {
            display: none;
            /* Chrome, Safari and Opera */
        }

        /* Portrait Rotation Enforcement Overlay */
        #portrait-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            color: white;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        @media screen and (orientation: portrait) and (max-width: 900px) {
            #portrait-overlay {
                display: flex;
            }

            .container,
            .top-nav {
                display: none !important;
            }
        }

        @media (max-width: 800px),
        (max-height: 500px) {
            h1 {
                font-size: 28px;
                margin-top: 10px;
            }

            .level-banner {
                font-size: 16px;
                padding: 5px 20px;
                margin-bottom: 10px;
            }

            .level-grid {
                grid-template-columns: repeat(auto-fit, minmax(65px, 1fr));
                /* Increased from 50px to make fewer level boxes per row */
                gap: 10px;
                max-height: calc(100vh - 120px);
                width: 100%;
                padding-top: 35px;
                /* Keeps stars from getting cut off on mobile */
                padding-bottom: 50px;
            }

            .level-btn span {
                font-size: 14px;
                margin-top: 2px;
            }

            .icon-btn {
                width: 45px;
                height: 45px;
            }
        }

        .level-btn {
            background-color: #14532d;
            /* Deep Forest Green */
            border: 3px solid #84cc16;
            /* Lime Green */
            border-radius: 8px;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            text-decoration: none;
            color: white;
            box-shadow: 0 4px 0 #000;
            transition: transform 0.1s;
            position: relative;
            margin-top: 5px;
            /* Spacing for star overflow */
        }

        .level-btn span {
            font-size: 18px;
            font-weight: bold;
            text-shadow: 3px 3px 0 #000;
            z-index: 2;
            margin-top: 5px;
        }

        .level-btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.2);
        }

        .level-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #000;
        }

        .stars {
            position: absolute;
            top: -24px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 2px;
            z-index: 3;
            width: 90px;
            pointer-events: none;
            /* Remove container drop-shadow to avoid double shadowing transparent text */
        }

        .stars span {
            display: inline-block;
            transition: transform 0.2s;
            position: relative;
            width: 22px;
            height: 22px;
        }

        .stars svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .stars path {
            fill: #fbbf24;
            stroke: #000;
            stroke-width: 2px;
            /* Creates the rounded corners */
            stroke-linejoin: round;
            paint-order: stroke fill;
        }

        /* Arch */
        .stars span:nth-child(1) {
            transform: translateY(6px) rotate(-20deg);
        }

        .stars span:nth-child(2) {
            transform: translateY(0px) scale(1.15);
            z-index: 4;
        }

        .stars span:nth-child(3) {
            transform: translateY(6px) rotate(20deg);
        }

        /* Hover effect */
        .level-btn:hover .stars span:nth-child(1) {
            transform: translateY(4px) rotate(-25deg) scale(1.1);
        }

        .level-btn:hover .stars span:nth-child(2) {
            transform: translateY(-2px) scale(1.25);
        }

        .level-btn:hover .stars span:nth-child(3) {
            transform: translateY(4px) rotate(25deg) scale(1.1);
        }


        /* Locked / Special States */
        /* Grey buttons for infinity */
        .level-btn.infinity {
            background-color: #374151;
            border-color: #9ca3af;
            box-shadow: 0 4px 0 #1f2937;
        }

        /* Red button for Level 50 */
        .level-btn.current {
            background-color: #b91c1c;
            /* Dark Red */
            border-color: #f87171;
            /* Light Red */
            box-shadow: 0 4px 0 #7f1d1d;
        }

        /* Demo locked state (if used) */
        .level-btn.locked {
            cursor: not-allowed;
            /* Keep green styling but non-interactive */
        }

        .lock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            /* Center vertically */
            padding-top: 0;
            z-index: 10;
        }

        /* Settings Container Font Override */
        .settings-container,
        .settings-container *,
        .volume-label,
        .settings-container .btn,
        #volPercent {
            font-family: 'Lilita One', cursive !important;
            letter-spacing: 1px;
        }

        /* Volume Slider Styling */
        .volume-control-container {
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            background: transparent;
            /* Removed background */
            padding: 10px 5px;
            border: none;
            border-bottom: 2px solid rgba(120, 53, 15, 0.2);
            /* Divider line */
            box-shadow: none;
            border-radius: 0;
        }

        .volume-icon {
            font-size: 32px;
            color: #0ea5e9;
            /* Sky Blue icon */
            filter: drop-shadow(2px 2px 0 #000);
            display: flex;
            align-items: center;
        }

        .volume-label {
            color: #374151;
            /* Softer Dark Grey (Gray-700) instead of Black */
            font-size: 20px;
            margin: 0;
            text-transform: uppercase;
            text-shadow: none;
            white-space: nowrap;
            margin-right: 15px;
            font-weight: 400;
            /* Reduced from 900 to Normal */
            flex-shrink: 0;
        }

        /* Volume Slider Styling - Dynamic Fill */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            flex-grow: 1;
            height: 22px;
            /* Slightly taller for the gloss */
            background: linear-gradient(to right, #facc15 0%, #facc15 60%, #374151 60%, #374151 100%);
            border-radius: 11px;
            /* perfectly round */
            outline: none;
            border: 2px solid #292524;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
            transition: background 0.05s linear;
            cursor: pointer;
        }

        /* Webkit Thumb - The Orange Pill */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 36px;
            background: linear-gradient(to bottom, #fbbf24, #ea580c);
            /* Yellow to Red-Orange */
            border: 2px solid #fef08a;
            /* Pale yellow border like reference */
            border-radius: 8px;
            /* Rounded rect, not circle */
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            margin-top: -7px;
        }

        /* Firefox Thumb */
        input[type=range]::-moz-range-thumb {
            width: 28px;
            height: 36px;
            background: linear-gradient(to bottom, #fbbf24, #ea580c);
            border: 2px solid #fef08a;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
        }

        /* Mobile Settings Layout Fix */
        @media (max-width: 800px) {
            .settings-wrapper {
                transform: scale(0.8);
            }
        }

        @media (max-width: 600px) {
            .settings-wrapper {
                transform: scale(0.65);
            }
        }

        @media (max-height: 500px) {
            .settings-wrapper {
                transform: scale(0.55);
            }
        }

        @media (max-height: 400px) {
            .settings-wrapper {
                transform: scale(0.45);
            }
        }
    </style>
</head>

<body>
    <!-- Fullscreen Loading Overlay -->
    <div id="loading-screen"
        style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: #000; z-index: 99999; display: flex; justify-content: center; align-items: center; color: white; font-family: 'Press Start 2P', cursive; font-size: 24px; transition: opacity 0.3s ease;">
        LOADING...
    </div>

    <!-- Portrait Rotation Overlay -->
    <div id="portrait-overlay">
        <svg style="width: 80px; height: 80px; margin-bottom: 20px" viewBox="0 0 24 24" fill="white">
            <path
                d="M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm1 18H7V5h10v14z"
                transform="rotate(90 12 12)" />
        </svg>
        <h2 style="font-size: 16px; line-height: 1.8; padding: 0 20px; font-family: 'Press Start 2P', cursive;">PLEASE
            ROTATE YOUR<br>DEVICE FOREVER</h2>
    </div>

    <div class="overlay"></div>

    <div class="top-nav">
        <!-- Back to Home using the Map icon logic, or just a home button? User asked for map/settings in top right on home. 
             But on levels page, usually you go back. I'll put Map (Home) on left top or similar layout.
             Let's stick to the visual reference if possible. Reference has Map icon top left, Setting top right. -->

        <!-- Image Back Arrow -->
        <a href="#" class="icon-btn" onclick="audio.playAndRedirect('index.html')">
            <img src="./img/left-arrow.png" alt="Back"
                style="width: 60%; height: 60%; object-fit: contain; filter: drop-shadow(4px 4px 0 #000);">
        </a>

        <a href="#" class="icon-btn" onclick="openSettings()"><img src="./img/setting.png" alt="Settings"
                style="width: 100%; height: 100%; object-fit: contain;"></a>
    </div>

    <div class="container">
        <h1>Samurai Showdown</h1>
        <div class="level-banner">â€º LEVEL SELECT â€¹</div>

        <div class="level-grid" id="levelGrid">
            <!-- JS will populate grid -->
        </div>
    </div>

    <script src="js/audio.js"></script>
    <script>
        // Hide loading screen when background image finishes loading
        window.addEventListener('load', () => {
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                loadingScreen.style.opacity = '0';
                setTimeout(() => loadingScreen.style.display = 'none', 300);
            }
        });

        const grid = document.getElementById('levelGrid');
        const totalLevels = 50;

        // Get unlocked progress
        const maxLevel = parseInt(localStorage.getItem('maxUnlockedLevel')) || 1;

        for (let i = 1; i <= 50; i++) {
            const btn = document.createElement('div'); // Changed to div for custom click handler
            btn.className = 'level-btn';

            // Unlocked State
            if (i <= maxLevel) {
                btn.onclick = () => {
                    sessionStorage.setItem('game_access', 'true');
                    window.location.href = 'game.html?level=' + i;
                };

                // Add Stars (SVG)
                const starsDiv = document.createElement('div');
                starsDiv.className = 'stars';
                const starSvg = '<svg viewBox="0 0 24 24"><path d="M12 2C12.5 2 13 2.5 13.2 2.9L15.6 7.7L20.9 8.5C21.7 8.6 22 9.6 21.4 10.2L17.6 13.9L18.5 19.2C18.6 20 17.8 20.6 17.1 20.2L12 17.6L6.9 20.2C6.2 20.6 5.4 20 5.5 19.2L6.4 13.9L2.6 10.2C2 9.6 2.3 8.6 3.1 8.5L8.4 7.7L10.8 2.9C11 2.5 11.5 2 12 2Z"/></svg>';
                starsDiv.innerHTML = `<span>${starSvg}</span><span>${starSvg}</span><span>${starSvg}</span>`;
                btn.appendChild(starsDiv);

                if (i === maxLevel) {
                    btn.classList.add('current'); // Highlight current level if needed
                }
            }
            // Locked State
            else {
                btn.classList.add('locked');

                // Overlay
                const overlay = document.createElement('div');
                overlay.className = 'lock-overlay';

                const lockImg = document.createElement('img');
                lockImg.src = 'img/lock.png';
                lockImg.alt = 'ðŸ”’'; // Fallback emoji
                lockImg.style.width = '90%';
                lockImg.style.height = '90%';
                lockImg.style.objectFit = 'contain';
                // Make it pop if transparency is an issue
                // lockImg.style.filter = 'drop-shadow(0 2px 4px rgba(0,0,0,0.5))';

                overlay.appendChild(lockImg);
                btn.appendChild(overlay);
            }

            // Add Level Number
            const numSpan = document.createElement('span');
            numSpan.innerText = i;
            btn.appendChild(numSpan);

            grid.appendChild(btn);
        }

        function openSettings() {
            document.getElementById('settingsModal').style.display = 'flex';
            if (window.audio) {
                const vol = audio.currentVolume;
                const slider = document.getElementById('volumeSlider');
                if (slider) {
                    slider.value = vol;
                    updateSliderFill(slider);
                }
            }
        }

        function updateVolume(val) {
            audio.setVolume(val);
            const slider = document.getElementById('volumeSlider');
            updateSliderFill(slider);
        }

        function updateSliderFill(slider) {
            const val = slider.value * 100;
            // Glossy effect: Lighter yellow fill (amber-400 to orange-500) | Warmer dark grey empty (stone-600 to stone-800)
            const emptyColor = "#6b7280"; // Gray-500
            const emptyDark = "#4b5563"; // Gray-600

            slider.style.background = `
                linear-gradient(to bottom, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 100%),
                linear-gradient(to right, #fbbf24 0%, #d97706 ${val}%, ${emptyColor} ${val}%, ${emptyDark} 100%)
            `;
        } function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                localStorage.removeItem('maxUnlockedLevel');
                location.reload();
            }
        }
    </script>

    <!-- Settings Modal -->
    <div id="settingsModal" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
        backdrop-filter: blur(5px);
    ">
        <div class="settings-wrapper"
            style="position: relative; display: flex; justify-content: center; align-items: center; transition: transform 0.2s ease;">
            <!-- Image Frame -->
            <img src="./img/setting-continer.png"
                style="width: 800px; height: auto; display: block; filter: drop-shadow(0 0 20px rgba(0,0,0,0.5));"
                alt="Settings Frame">

            <!-- Content Overlay -->
            <div class="settings-content-container" style="
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 140px 60px 60px 60px; /* Increased top padding to clear built-in title */
                text-align: center;
            ">

                <!-- Controls Guide -->
                <!-- Volume Control -->
                <div class="volume-control-container">
                    <span class="volume-icon" style="margin-right: 15px;">
                        <img src="./img/speaker.png" alt="Speaker" width="45" height="45"
                            style="filter: drop-shadow(2px 3px 2px rgba(0,0,0,0.3));">
                    </span>
                    <span class="volume-label">MASTER VOLUME</span>
                    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.6"
                        oninput="updateVolume(this.value)">
                </div>

                <!-- Actions -->
                <!-- Actions -->
                <div
                    style="display: flex; flex-direction: row; gap: 20px; width: 100%; justify-content: center; margin-top: 20px;">
                    <button onclick="resetProgress()" class="btn" style="
                            background-color: #ef4444; 
                            border: 3px solid #000; 
                            box-shadow: 4px 4px 0px #000; 
                            color: white;
                            font-family: 'Lilita One', cursive; 
                            font-size: 20px; 
                            padding: 10px 20px;
                            border-radius: 8px;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            transition: transform 0.1s, box-shadow 0.1s;
                            cursor: pointer;
                            flex: 1;
                            max-width: 200px;
                        "
                        onmousedown="this.style.transform='translate(2px, 2px)'; this.style.boxShadow='2px 2px 0px #000';"
                        onmouseup="this.style.transform='translate(0, 0)'; this.style.boxShadow='4px 4px 0px #000';"
                        onmouseleave="this.style.transform='translate(0, 0)'; this.style.boxShadow='4px 4px 0px #000';">
                        DELETE SAVE
                    </button>
                    <button onclick="closeSettings()" class="btn" style="
                            background-color: #3b82f6; 
                            border: 3px solid #000; 
                            box-shadow: 4px 4px 0px #000; 
                            color: white;
                            font-family: 'Lilita One', cursive; 
                            font-size: 20px; 
                            padding: 10px 20px;
                            border-radius: 8px;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            transition: transform 0.1s, box-shadow 0.1s;
                            cursor: pointer;
                            flex: 1;
                            max-width: 200px;
                        "
                        onmousedown="this.style.transform='translate(2px, 2px)'; this.style.boxShadow='2px 2px 0px #000';"
                        onmouseup="this.style.transform='translate(0, 0)'; this.style.boxShadow='4px 4px 0px #000';"
                        onmouseleave="this.style.transform='translate(0, 0)'; this.style.boxShadow='4px 4px 0px #000';">
                        CLOSE
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>