<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2c2c2c" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="manifest" href="./manifest.json" />
    <title>Samurai Showdown - Levels</title>
    <!-- Preload Fonts to stop FOUT (font changes) -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" as="style" />
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" as="style" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" rel="stylesheet" />

    <!-- Preload heavy background image so it starts loading immediately -->
    <link rel="preload" as="image" href="./img/homepage.png" />

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Press Start 2P', cursive;
        }

        body {
            background-color: #2c2c2c;
            background-image: url('./img/homepage.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            text-shadow: 4px 4px 0px #000;
            overflow: hidden;
            position: relative;
        }

        /* Dark overlay */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1;
            pointer-events: none;
        }

        /* Top Navigation */
        .top-nav {
            position: absolute;
            top: 20px;
            width: 100%;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            z-index: 2;
        }

        .icon-btn {
            width: 70px;
            height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-decoration: none;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
            background: transparent;
        }

        .icon-btn:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }

        /* Generic Button Style (for Modal) */
        .btn {
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
            box-shadow: 6px 6px 0px #000;
            display: inline-block;
            text-align: center;
            color: white;
            border: 4px solid white;
            text-shadow: 2px 2px 0px #000;
        }

        .btn:hover {
            transform: scale(1.05);
            filter: brightness(1.2);
            /* Brightens any color button */
        }

        .btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px #000;
        }

        /* Main Content */
        .container {
            position: relative;
            z-index: 2;
            width: 90%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 60px;
        }

        h1 {
            font-size: 48px;
            margin-bottom: 10px;
            text-transform: uppercase;
            text-align: center;
        }

        .level-banner {
            background-color: #fca5a5;
            /* Light red/orange base */
            background: linear-gradient(to bottom, #fbbf24, #f59e0b);
            /* Gold gradient */
            padding: 10px 40px;
            border: 4px solid white;
            color: white;
            font-size: 24px;
            margin-bottom: 30px;
            position: relative;
            display: inline-block;
            box-shadow: 0 4px 0 #000;
        }

        .level-banner::before {
            content: '›';
            position: absolute;
            left: 10px;
        }

        .level-banner::after {
            content: '‹';
            position: absolute;
            right: 10px;
        }

        /* Grid */
        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
            gap: 15px;
            width: 95%;
            max-width: 1400px;
            /* Allow wide layout */
            justify-content: center;
            padding-top: 35px;
            /* Increased space for popping stars to avoid cut-off */
            padding-bottom: 50px;
            overflow-y: auto;
            max-height: calc(100vh - 180px);

            /* Hide scrollbar */
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        .level-grid::-webkit-scrollbar {
            display: none;
            /* Chrome, Safari and Opera */
        }

        /* Portrait Rotation Enforcement Overlay */
        #portrait-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            color: white;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        @media screen and (orientation: portrait) and (max-width: 900px) {
            #portrait-overlay {
                display: flex;
            }

            .container,
            .top-nav {
                display: none !important;
            }
        }

        @media (max-width: 800px),
        (max-height: 500px) {
            h1 {
                display: none;
                /* Hide header on mobile so only "LEVEL SELECT" shows */
            }

            .top-nav {
                top: 10px;
                padding: 0 15px;
            }

            .container {
                margin-top: 25px;
                /* Drop width to 85% instead of 98% to forcefully create blank space on BOTH left and right sides! */
                width: 85%;
                /* Update constraint matching the new narrower 13 column width */
                max-width: calc(230vh - 120px);
            }

            .level-banner {
                font-size: 14px;
                padding: 4px 15px;
                margin-top: 0px;
                margin-bottom: 5px;
            }

            .level-grid {
                /* 13 columns to keep it mathematically limited to 4 rows */
                grid-template-columns: repeat(13, minmax(0, 1fr));
                /* Increase the gap significantly between boxes so they aren't squished tighter by the new side margins */
                gap: 1.5vw;
                max-height: none;
                overflow: visible !important;
                width: 100%;
                padding-top: 45px;
                /* Greatly increased top padding so the banner doesn't sit right on top of the grid */
                padding-bottom: 45px;
                /* Symmetrically increased the bottom padding to match the top space */
            }

            .level-btn {
                border-width: 2px !important;
                /* Thinner border for tiny boxes so it doesn't crush the inside lock */
            }

            .level-btn span {
                font-size: 10px !important;
                /* !important is required because global span styles declared later in the file are overriding this rule! */
                margin-top: 1px !important;
            }

            .stars {
                width: 100% !important;
                /* Re-center and tighten */
                top: -12px !important;
                /* Bring it perfectly down to kiss the top edge of the box */
                gap: 0 !important;
                /* Very little spacing on mobile */
            }

            .stars span {
                width: 11px !important;
                height: 11px !important;
                max-width: none !important;
                max-height: none !important;
            }

            /* The Global CSS arch pushes stars down 6px! On an 11px star, that breaks it in half. Scaling it gracefully... */
            .stars span:nth-child(1) {
                transform: translateY(2px) rotate(-20deg) !important;
            }

            .stars span:nth-child(2) {
                transform: translateY(0) scale(1.1) !important;
            }

            .stars span:nth-child(3) {
                transform: translateY(2px) rotate(20deg) !important;
            }

            .icon-btn {
                width: 52px;
                height: 52px;
            }
        }

        .level-btn {
            background-color: #14532d;
            /* Deep Forest Green */
            border: 3px solid #84cc16;
            /* Lime Green */
            border-radius: 8px;
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            text-decoration: none;
            color: white;
            box-shadow: 0 4px 0 #000;
            transition: transform 0.1s;
            position: relative;
            margin-top: 5px;
            /* Spacing for star overflow */
        }

        .level-btn span {
            font-size: 18px;
            font-weight: bold;
            text-shadow: 3px 3px 0 #000;
            z-index: 2;
            margin-top: 5px;
        }

        .level-btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.2);
        }

        .level-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #000;
        }

        .stars {
            position: absolute;
            top: -24px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 2px;
            z-index: 3;
            width: 90px;
            pointer-events: none;
            /* Remove container drop-shadow to avoid double shadowing transparent text */
        }

        .stars span {
            display: inline-block;
            transition: transform 0.2s;
            position: relative;
            width: 22px;
            height: 22px;
        }

        .stars svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .stars path {
            fill: #fbbf24;
            stroke: #000;
            stroke-width: 2px;
            /* Creates the rounded corners */
            stroke-linejoin: round;
            paint-order: stroke fill;
        }

        /* Arch */
        .stars span:nth-child(1) {
            transform: translateY(6px) rotate(-20deg);
        }

        .stars span:nth-child(2) {
            transform: translateY(0px) scale(1.15);
            z-index: 4;
        }

        .stars span:nth-child(3) {
            transform: translateY(6px) rotate(20deg);
        }

        /* Hover effect */
        .level-btn:hover .stars span:nth-child(1) {
            transform: translateY(4px) rotate(-25deg) scale(1.1);
        }

        .level-btn:hover .stars span:nth-child(2) {
            transform: translateY(-2px) scale(1.25);
        }

        .level-btn:hover .stars span:nth-child(3) {
            transform: translateY(4px) rotate(25deg) scale(1.1);
        }


        /* Locked / Special States */
        /* Grey buttons for infinity */
        .level-btn.infinity {
            background-color: #374151;
            border-color: #9ca3af;
            box-shadow: 0 4px 0 #1f2937;
        }

        /* Red button for Level 50 */
        .level-btn.current {
            background-color: #b91c1c;
            /* Dark Red */
            border-color: #f87171;
            /* Light Red */
            box-shadow: 0 4px 0 #7f1d1d;
        }

        /* Demo locked state (if used) */
        .level-btn.locked {
            cursor: not-allowed;
            /* Keep green styling but non-interactive */
        }

        .lock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            /* Center vertically */
            padding-top: 0;
            z-index: 10;
        }

        /* Settings Container Font Override */
        .settings-container,
        .settings-container *,
        .volume-label,
        .settings-container .btn,
        #volPercent {
            font-family: 'Lilita One', cursive !important;
            letter-spacing: 1px;
        }

        /* Volume Slider Styling */
        .volume-control-container {
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            background: transparent;
            /* Removed background */
            padding: 10px 5px;
            border: none;
            border-bottom: 2px solid rgba(120, 53, 15, 0.2);
            /* Divider line */
            box-shadow: none;
            border-radius: 0;
        }

        .volume-icon {
            font-size: 32px;
            color: #0ea5e9;
            /* Sky Blue icon */
            filter: drop-shadow(2px 2px 0 #000);
            display: flex;
            align-items: center;
        }

        .volume-label {
            color: #374151;
            /* Softer Dark Grey (Gray-700) instead of Black */
            font-size: 20px;
            margin: 0;
            text-transform: uppercase;
            text-shadow: none;
            white-space: nowrap;
            margin-right: 15px;
            font-weight: 400;
            /* Reduced from 900 to Normal */
            flex-shrink: 0;
        }

        /* Volume Slider Styling - Dynamic Fill */
        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            flex-grow: 1;
            height: 22px;
            /* Slightly taller for the gloss */
            background: linear-gradient(to right, #facc15 0%, #facc15 60%, #374151 60%, #374151 100%);
            border-radius: 11px;
            /* perfectly round */
            outline: none;
            border: 2px solid #292524;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
            transition: background 0.05s linear;
            cursor: pointer;
        }

        /* Webkit Thumb - The Orange Pill */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 36px;
            background: linear-gradient(to bottom, #fbbf24, #ea580c);
            /* Yellow to Red-Orange */
            border: 2px solid #fef08a;
            /* Pale yellow border like reference */
            border-radius: 8px;
            /* Rounded rect, not circle */
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            margin-top: -7px;
        }

        /* Firefox Thumb */
        input[type=range]::-moz-range-thumb {
            width: 28px;
            height: 36px;
            background: linear-gradient(to bottom, #fbbf24, #ea580c);
            border: 2px solid #fef08a;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
        }

        /* Mobile Settings Layout Fix */
        @media (max-width: 800px) {
            .settings-wrapper {
                transform: scale(0.8);
            }
        }

        @media (max-width: 600px) {
            .settings-wrapper {
                transform: scale(0.65);
            }
        }

        @media (max-height: 500px) {
            .settings-wrapper {
                transform: scale(0.55);
            }
        }

        @media (max-height: 400px) {
            .settings-wrapper {
                transform: scale(0.45);
            }
        }
    </style>
</head>

<body>
    <!-- Fullscreen Loading Overlay - Show inline immediately without visual jumps -->
    <div id="loading-screen"
        style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: #000; z-index: 99999; display: flex; justify-content: center; align-items: center; color: white; font-family: 'Press Start 2P', system-ui, sans-serif; font-size: 24px; transition: opacity 0.2s ease;">
        LOADING...
    </div>

    <!-- Portrait Rotation Overlay -->
    <div id="portrait-overlay">
        <svg style="width: 80px; height: 80px; margin-bottom: 20px" viewBox="0 0 24 24" fill="white">
            <path
                d="M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm1 18H7V5h10v14z"
                transform="rotate(90 12 12)" />
        </svg>
        <h2 style="font-size: 16px; line-height: 1.8; padding: 0 20px; font-family: 'Press Start 2P', cursive;">PLEASE
            ROTATE YOUR<br>DEVICE FOREVER</h2>
    </div>

    <div class="overlay"></div>

    <div class="top-nav">
        <!-- Back to Home using the Map icon logic, or just a home button? User asked for map/settings in top right on home. 
             But on levels page, usually you go back. I'll put Map (Home) on left top or similar layout.
             Let's stick to the visual reference if possible. Reference has Map icon top left, Setting top right. -->

        <!-- Glossy Orange Circular Back Arrow (Matches Original Image) -->
        <a href="#" class="icon-btn" onclick="audio.playAndRedirect('index.html')">
            <svg viewBox="0 0 48 48"
                style="width: 72%; height: 72%; filter: drop-shadow(0px 3px 3px rgba(0,0,0,0.6)); overflow: visible;">
                <defs>
                    <radialGradient id="orangeBtn" cx="50%" cy="30%" r="70%">
                        <stop offset="0%" stop-color="#fbbf24" />
                        <stop offset="60%" stop-color="#f59e0b" />
                        <stop offset="100%" stop-color="#b45309" />
                    </radialGradient>
                </defs>
                <circle cx="24" cy="24" r="22" fill="url(#orangeBtn)" stroke="#78350f" stroke-width="1.5" />
                <!-- Curved return arrow (Perfectly Centered) -->
                <path d="M13 25 L23 15 V20 C32 20 35 25 34 33 C34 31 29 27 23 27 V32 Z" fill="#ffffff"
                    filter="drop-shadow(0px 2px 1px rgba(0,0,0,0.4))" />
            </svg>
        </a>

        <!-- Image Settings Gear -->
        <a href="#" class="icon-btn" onclick="openSettings()"><img src="./img/setting.png" alt="Settings"
                style="width: 100%; height: 100%; object-fit: contain;"></a>
    </div>

    <div class="container">
        <h1>Samurai Showdown</h1>
        <div class="level-banner">› LEVEL SELECT ‹</div>

        <div class="level-grid" id="levelGrid">
            <!-- JS will populate grid -->
        </div>
    </div>

    <script src="js/audio.js"></script>
    <script>
        // --- PRELOADER & LAZY LOADING SYSTEM (LEVELS PAGE) ---
        const assetsToLoad = [
            './img/homepage.png',
            './img/setting.png'
        ];

        let assetsLoadedCount = 0;
        const totalAssetsCount = assetsToLoad.length;
        const loadingScreenEl = document.getElementById('loading-screen');
        let loadingComplete = false;
        let displayedPercent = 0;

        function updateActualProgress() {
            assetsLoadedCount++;
        }

        // Visual loading percentage animator
        const loadingInterval = setInterval(() => {
            if (loadingComplete) return;

            // The actual percentage loaded
            const targetPercent = Math.floor((assetsLoadedCount / totalAssetsCount) * 100);

            // Smoothly increment displayed percentage to catch up
            if (displayedPercent < targetPercent) {
                displayedPercent += 3; // Speed of climb
            } else if (displayedPercent < 95 && assetsLoadedCount < totalAssetsCount) {
                // Artificial small progression while waiting
                if (Math.random() > 0.8) displayedPercent += 1;
            }

            // Cap it
            if (displayedPercent > 99 && assetsLoadedCount < totalAssetsCount) {
                displayedPercent = 99;
            }
            if (displayedPercent > 100) displayedPercent = 100;

            // Update UI
            if (loadingScreenEl && !loadingScreenEl.innerText.includes("SLOW")) {
                loadingScreenEl.innerText = `LOADING... ${displayedPercent}%`;
            }

            // Finished!
            if (displayedPercent >= 100 && assetsLoadedCount >= totalAssetsCount) {
                loadingComplete = true;
                clearInterval(loadingInterval);

                if (loadingScreenEl) {
                    loadingScreenEl.style.opacity = '0';
                    setTimeout(() => loadingScreenEl.style.display = 'none', 300);
                }
            }
        }, 30); // update every 30ms

        // Start loading the strictly necessary images in memory
        document.addEventListener('DOMContentLoaded', () => {
            assetsToLoad.forEach(src => {
                const img = new Image();
                img.onload = updateActualProgress;
                img.onerror = updateActualProgress;
                img.src = src;
            });

            // Fallback message if loading is taking way too long (Slow Internet detected)
            setTimeout(() => {
                if (!loadingComplete && loadingScreenEl) {
                    loadingScreenEl.style.fontSize = "16px";
                    loadingScreenEl.innerText = `SLOW INTERNET...\nPLEASE WAIT (${displayedPercent}%)`;
                }
            }, 4000); // 4 seconds wait time
        });

        const grid = document.getElementById('levelGrid');
        const totalLevels = 50;

        // Get unlocked progress
        const maxLevel = parseInt(localStorage.getItem('maxUnlockedLevel')) || 1;

        for (let i = 1; i <= 50; i++) {
            const btn = document.createElement('div'); // Changed to div for custom click handler
            btn.className = 'level-btn';

            // Unlocked State
            if (i <= maxLevel) {
                btn.onclick = () => {
                    sessionStorage.setItem('game_access', 'true');
                    window.location.href = 'game.html?level=' + i;
                };

                // Add Stars (SVG)
                const starsDiv = document.createElement('div');
                starsDiv.className = 'stars';
                const starSvg = '<svg viewBox="0 0 24 24"><path d="M12 2C12.5 2 13 2.5 13.2 2.9L15.6 7.7L20.9 8.5C21.7 8.6 22 9.6 21.4 10.2L17.6 13.9L18.5 19.2C18.6 20 17.8 20.6 17.1 20.2L12 17.6L6.9 20.2C6.2 20.6 5.4 20 5.5 19.2L6.4 13.9L2.6 10.2C2 9.6 2.3 8.6 3.1 8.5L8.4 7.7L10.8 2.9C11 2.5 11.5 2 12 2Z"/></svg>';
                starsDiv.innerHTML = `<span>${starSvg}</span><span>${starSvg}</span><span>${starSvg}</span>`;
                btn.appendChild(starsDiv);

                if (i === maxLevel) {
                    btn.classList.add('current'); // Highlight current level if needed
                }
            }
            // Locked State
            else {
                btn.classList.add('locked');

                // Overlay
                const overlay = document.createElement('div');
                overlay.className = 'lock-overlay';

                // Realistic 3D Golden Lock (Matches Original Image)
                overlay.innerHTML = `
                  <svg viewBox="0 0 64 64" style="width: 55%; height: 55%; filter: drop-shadow(0px 3px 4px rgba(0,0,0,0.7)); overflow: visible;">
                    <defs>
                      <linearGradient id="shackle" x1="0" y1="0" x2="1" y2="0">
                        <stop offset="0%" stop-color="#9ca3af"/>
                        <stop offset="25%" stop-color="#f3f4f6"/>
                        <stop offset="75%" stop-color="#d1d5db"/>
                        <stop offset="100%" stop-color="#4b5563"/>
                      </linearGradient>
                      <linearGradient id="goldBody" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stop-color="#fef08a"/>
                        <stop offset="20%" stop-color="#eab308"/>
                        <stop offset="80%" stop-color="#a16207"/>
                        <stop offset="100%" stop-color="#713f12"/>
                      </linearGradient>
                    </defs>
                    <!-- Steel Shackle -->
                    <path d="M18 30 V16 C18 8 46 8 46 16 V30" fill="none" stroke="url(#shackle)" stroke-width="8" stroke-linecap="round"/>
                    <path d="M18 30 V16 C18 8 46 8 46 16 V30" fill="none" stroke="#374151" stroke-width="1.5" stroke-linecap="round"/>
                    <!-- Shiny Gold Body -->
                    <rect x="8" y="28" width="48" height="34" rx="4" fill="url(#goldBody)" stroke="#422006" stroke-width="1.5" />
                    <rect x="10" y="30" width="44" height="4" fill="#a16207" opacity="0.4" />
                    <!-- Keyhole -->
                    <circle cx="32" cy="42" r="5" fill="#111827" />
                    <path d="M29 45 L27 54 H37 L35 45 Z" fill="#111827" />
                  </svg>
                `;
                btn.appendChild(overlay);
            }

            // Add Level Number
            const numSpan = document.createElement('span');
            numSpan.innerText = i;
            btn.appendChild(numSpan);

            grid.appendChild(btn);
        }

        function openSettings() {
            document.getElementById('settingsModal').style.display = 'flex';
            if (window.audio) {
                const vol = audio.currentVolume;
                const slider = document.getElementById('volumeSlider');
                if (slider) {
                    slider.value = vol;
                    updateSliderFill(slider);
                }
            }
        }

        function updateVolume(val) {
            audio.setVolume(val);
            const slider = document.getElementById('volumeSlider');
            updateSliderFill(slider);
        }

        function updateSliderFill(slider) {
            const val = slider.value * 100;
            // Glossy effect: Lighter yellow fill (amber-400 to orange-500) | Warmer dark grey empty (stone-600 to stone-800)
            const emptyColor = "#6b7280"; // Gray-500
            const emptyDark = "#4b5563"; // Gray-600

            slider.style.background = `
                linear-gradient(to bottom, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 100%),
                linear-gradient(to right, #fbbf24 0%, #d97706 ${val}%, ${emptyColor} ${val}%, ${emptyDark} 100%)
            `;
        } function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                localStorage.removeItem('maxUnlockedLevel');
                location.reload();
            }
        }
    </script>

    <!-- Settings Modal -->
    <div id="settingsModal" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
        backdrop-filter: blur(5px);
    ">
        <div class="settings-wrapper"
            style="position: relative; display: flex; justify-content: center; align-items: center; transition: transform 0.2s ease;">
            <!-- Image Frame -->
            <img src="./img/setting-continer.png"
                style="width: 800px; height: auto; display: block; filter: drop-shadow(0 0 20px rgba(0,0,0,0.5));"
                alt="Settings Frame">

            <!-- Content Overlay -->
            <div class="settings-content-container" style="
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 140px 60px 60px 60px; /* Increased top padding to clear built-in title */
                text-align: center;
            ">

                <!-- Controls Guide -->
                <!-- Volume Control -->
                <div class="volume-control-container">
                    <span class="volume-icon" style="margin-right: 15px;">
                        <img src="./img/speaker.png" alt="Speaker" width="45" height="45"
                            style="filter: drop-shadow(2px 3px 2px rgba(0,0,0,0.3));">
                    </span>
                    <span class="volume-label">MASTER VOLUME</span>
                    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.6"
                        oninput="updateVolume(this.value)">
                </div>

                <!-- Actions -->
                <!-- Actions -->
                <div
                    style="display: flex; flex-direction: row; gap: 20px; width: 100%; justify-content: center; margin-top: 20px;">
                    <button onclick="resetProgress()" class="btn" style="
                            background-color: #ef4444; 
                            border: 3px solid #000; 
                            box-shadow: 4px 4px 0px #000; 
                            color: white;
                            font-family: 'Lilita One', cursive; 
                            font-size: 20px; 
                            padding: 10px 20px;
                            border-radius: 8px;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            transition: transform 0.1s, box-shadow 0.1s;
                            cursor: pointer;
                            flex: 1;
                            max-width: 200px;
                        "
                        onmousedown="this.style.transform='translate(2px, 2px)'; this.style.boxShadow='2px 2px 0px #000';"
                        onmouseup="this.style.transform='translate(0, 0)'; this.style.boxShadow='4px 4px 0px #000';"
                        onmouseleave="this.style.transform='translate(0, 0)'; this.style.boxShadow='4px 4px 0px #000';">
                        DELETE SAVE
                    </button>
                    <button onclick="closeSettings()" class="btn" style="
                            background-color: #3b82f6; 
                            border: 3px solid #000; 
                            box-shadow: 4px 4px 0px #000; 
                            color: white;
                            font-family: 'Lilita One', cursive; 
                            font-size: 20px; 
                            padding: 10px 20px;
                            border-radius: 8px;
                            text-transform: uppercase;
                            letter-spacing: 1px;
                            transition: transform 0.1s, box-shadow 0.1s;
                            cursor: pointer;
                            flex: 1;
                            max-width: 200px;
                        "
                        onmousedown="this.style.transform='translate(2px, 2px)'; this.style.boxShadow='2px 2px 0px #000';"
                        onmouseup="this.style.transform='translate(0, 0)'; this.style.boxShadow='4px 4px 0px #000';"
                        onmouseleave="this.style.transform='translate(0, 0)'; this.style.boxShadow='4px 4px 0px #000';">
                        CLOSE
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered!', reg))
                    .catch(err => console.log('SW failed!', err));
            });
        }
    </script>
</body>

</html>